<!doctype html>
<html lang=en-US>
<meta charset=utf-8>
<title class=not-draft>Quirks Mode</title>
<title class="not-tr not-fs">Quirks Mode Standard</title>
<style>
 p.status { position:absolute; margin:-2em 0 0 -125px; width:100px; text-align:center; line-height:3; border:thin solid; font-size:smaller; background:papayawhip; color:black; border-radius:5px }
 p.status::after { content:'\25BA'; position:absolute; right:3px; width:0; color:papayawhip; text-shadow:black 2px 0 0; cursor:default }

 .logo { position:absolute; top:1em; right:1em; width:106px; height:106px; border:1px outset gray; margin-top:-4px; margin-right:-4px }
 div.head .logo > img { top:2px; right:2px; border:1px inset gray }
</style>
<link class="not-tr" href="https://whatwg.org/style/specification" rel="stylesheet">
<link rel=stylesheet class="not-draft not-fs" href="http://www.w3.org/StyleSheets/TR/W3C-[STATUS]">
<meta name=robots content="noindex, follow" class="not-draft">
<link href="https://resources.whatwg.org/logo.svg" rel="icon">

<div class="head">

<p><a class="logo" href="https://whatwg.org/"><img alt="WHATWG" src="https://resources.whatwg.org/logo.svg" width=100 height=100></a></p>

<hgroup>
<h1>Quirks Mode</h1>
<h2 class="no-num no-toc not-tr not-fs">Living Standard &mdash; [DATE: 01 Jan 1901]</h2>
<h2 class="no-num no-toc not-draft not-tr">Snapshot Specification for Lawyers &mdash; [DATE: 01 Jan 1901]</h2>
<h2 class="no-num no-toc not-draft not-fs">[LONGSTATUS] [DATE: 01 Jan 1901]</h2>
</hgroup>

<dl>
 <dt>This Version:
 <dd class="not-tr not-fs"><a href="https://quirks.spec.whatwg.org/">https://quirks.spec.whatwg.org/</a>
 <dd class="not-draft not-fs"><a href="[VERSION]">[VERSION]</a>
 <dd class="not-draft not-tr">XXX

 <dt class="not-draft not-fs">Latest Version:
 <dd class="not-draft not-fs"><a href="[LATEST]">[LATEST]</a>

 <dt class="not-draft">Latest Editor's Draft:
 <dd class="not-draft"><a href="https://quirks.spec.whatwg.org/">https://quirks.spec.whatwg.org/</a>

 <dt class="not-tr">Participate:</dt>
 <dd class="not-tr">Send feedback to <a href="https://whatwg.org/mailing-list">whatwg@whatwg.org</a>
 or <a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WHATWG&amp;component=Quirks%20Mode">file a bug</a> (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WHATWG&amp;component=Quirks%20Mode&amp;resolution=---">open bugs</a>)
 <dd class="no-tr"><a href="https://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Version History:
 <dd><a href="https://github.com/whatwg/quirks/commits">https://github.com/whatwg/quirks/commits</a></dd>
 <dt>Editor:
 <dd>
  Simon Pieters
  (<a href="http://www.opera.com/">Opera Software ASA</a>)
  &lt;<a href="mailto:simonp@opera.com">simonp@opera.com</a>>
</dl>

<script src=https://resources.whatwg.org/file-bug.js async></script>

<p class="copyright not-draft not-tr">Copyright &copy; [YEAR] the Contributors to the Quirks Mode Specification, published by the <a href="http://www.w3.org/community/whatwg/">WHATCG</a> under the <a href="http://www.w3.org/community/about/agreements/final/">W3C Community Final Specification Agreement (FSA)</a>. A human-readable <a href="http://www.w3.org/community/about/agreements/fsa-deed/">summary</a> is available.

<p class="copyright not-tr not-fs"><a href="http://creativecommons.org/publicdomain/zero/1.0/" rel="license"><img alt="CC0" src="https://i.creativecommons.org/p/zero/1.0/80x15.png"></a>
To the extent possible under law, the editors have waived all copyright and
related or neighboring rights to this work. In addition, as of
[DATE: 01 Jan 1901], the editors have made this specification available
under the
<a href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0" rel="license">Open Web Foundation Agreement Version 1.0</a>,
which is available at
http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.

<div class="not-draft not-fs"><!--copyright-->

<hr class=top>

<h2 class="no-num no-toc">Abstract</h2>
<p>XXX

<h2 class="no-num no-toc"><span id="sotd">Status of this Document</span></h2>
<p>XXX
</div>
</div>

<hr class="top">

<div class="not-tr not-draft">
<h2 class="no-num no-toc">Disclaimer</h2>

<p>This specification was published by the <a href="http://www.w3.org/community/whatwg/">WHATCG</a>. It is not a W3C Standard nor is it on the W3C Standards Track. Please note that under the <a href="http://www.w3.org/community/about/agreements/final/">W3C Community Final Specification Agreement (FSA)</a> other conditions apply. Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>.</p>
</div>

<h2 class="no-num no-toc">Table of Contents</h2>

<!--toc-->

<h2>Introduction</h2>

<h3>History</h3>

<p>Browsers have several rendering modes to render HTML documents. The reason for this is basically a historical accident. The CSS specification was incompatible with the behavior of existing browsers which existing Web content relied on. In order to comply with the specification while not breaking existing content, browsers introduced a new rendering mode (no-quirks mode). Some browsers still had the shrink-wrapping behavior for images in table cells in their no-quirks mode, and sites started relying on that, so browsers that implemented the specification's behavior introduced a third mode (limited-quirks mode). In hindsight, it would have been better to make the default CSS behavior be compatible with what the existing content relied on and providing opt-ins to different behavior. The different modes have since gained a few differences outside of CSS.

<h3>Goals</h3>

<ul>
<li>Create a specification for rendering old (or indeed new, if they happen to have a particular pragma) HTML documents.
<li>Remove quirks from implementations that are not needed for Web compatibility.
<li>Get interoperability on quirks that <em>are</em> needed for Web compatibility.
<li>Where possible, limit quirks to a fixed set of legacy features so they don't propagate into new features.
</ul>

<p class=note>This specification does not enumerate all quirks that currently exist in browsers. A number of quirks are specified in HTML, DOM, CSSOM and CSSOM View. <span data-anolis-ref class=informative>HTML</span> <span data-anolis-ref class=informative>DOM</span> <span data-anolis-ref class=informative>CSSOM</span> <span data-anolis-ref class=informative>CSSOMVIEW</span> If a quirk is not specified anywhere, it is probably due to the second bullet point above.

<h2>Common infrastructure</h2>

<h3>Conformance</h3>

<p>All diagrams, examples, and notes in this specification are non-normative, as are all sections explicitly marked non-normative. Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this specification are to be interpreted as described in RFC2119. For readability, these words do not appear in all uppercase letters in this specification. <span data-anolis-ref>RFC2119</span>

<h3>Terminology</h3>

<p>When this specification refers to a "<code><var>foo</var></code> element", it means an element with the local name <code><var>foo</var></code> and having the namespace <code>http://www.w3.org/1999/xhtml</code>.

<p>When this specification refers to a "<code><var>foo</var></code> attribute", it means an attribute with the local name <code><var>foo</var></code> and having no namespace.

<h3>Dependencies</h3>

<p>The terms <dfn>illegal value</dfn>, <dfn>block container element</dfn>, <dfn>inline-level</dfn>, <dfn>containing block</dfn>, <dfn>initial containing block</dfn> and <dfn>block container box</dfn> are defined in CSS 2.1. <span data-anolis-ref>CSS</span>

<p>The terms <dfn>minimum intrinsic width of an inline formatting context</dfn> and <dfn>outer intrinsic minimum width of a table cell</dfn> are defined in More Precise Definitions of Intrinsic Widths and Table Layout (Proposal). <span data-anolis-ref>CSSINTRINSIC</span>

<p>The terms <dfn>&lt;number-token&gt;</dfn>, <dfn>&lt;dimension-token></dfn> and <dfn>&lt;ident-token></dfn> are defined in CSS Syntax Module. <span data-anolis-ref>CSSSYNTAX</span>

<p>The terms <dfn>&lt;color></dfn>, <dfn>&lt;length></dfn> and <dfn>number</dfn> are defined in CSS Values and Units Module. <span data-anolis-ref>CSSVALUES</span>

<p>Some terms are defined in DOM and HTML. <span data-anolis-ref>DOM</span> <span data-anolis-ref>HTML</span>

<h2>CSS</h2>

<h3>The hashless hex color quirk</h3>

<p class="status not-tr">Run <a href="http://w3c-test.org/quirks-mode/hashless-hex-color.html">tests</a>

<p>Quirky colors are denoted by <dfn>&lt;quirky-color></dfn>. A <dfn>quirky color</dfn> corresponds to a <span>&lt;number-token></span>, a <span>&lt;dimension-token></span> or an <span>&lt;ident-token></span> component value in the syntax. The value of a <span>quirky color</span> is obtained from the possible component values using the following algorithm, aborting on the first step that returns a value:

<ol>
 <li>Let <var>cv</var> be the component value.
 <li>
  <p>If <var>cv</var> is a <span>&lt;number-token></span> or a <span>&lt;dimension-token></span>, follow these substeps:
  <ol>
   <li><p>If <var>cv</var>'s type flag is not "integer", return an error.
   <li><p>If <var>cv</var>'s value is less than zero, return an error.
   <li><p>Let <var>serialization</var> be the serialization of <var>cv</var>'s value,
   as a base-ten integer using digits 0-9 (U+0030 to U+0039) in the shortest form possible.
   <li><p>If <var>cv</var> is a <span>&lt;dimension-token></span>, append the unit to <var>serialization</var>.
   <li><p>If <var>serialization</var> consists of fewer than six characters, prepend zeros (U+0030) so that it becomes six characters.
  </ol>
 <li><p>Otherwise, <var>cv</var> is an <span>&lt;ident-token></span>; let <var>serialization</var> be <var>cv</var>'s value.
 <li><p>If <var>serialization</var> does not consist of three or six characters, return an error.
 <li><p>If <var>serialization</var> contains any characters not in the range [0-9A-Fa-f] (U+0030 to U+0039, U+0041 to U+0046, U+0061 to U+0066), return an error.
 <li><p>Return the concatenation of "<code title>#</code>" (U+0023) and <var>serialization</var>.
</ol>

<p>If the value of a <span>quirky color</span> is an error, it is an <span>illegal value</span>.
Otherwise, the value of a <span>quirky color</span> must be interpreted as an RGB value in hexadecimal notation using the same rules as for <span>&lt;color></span>.

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, the following properties must have their "Value" grammar changed by replacing <span>&lt;color></span> with [ <span>&lt;color></span> | <span>&lt;quirky-color></span> ]:

<ul class=brief>
<li>'background-color'
<li>'border-color'
<li>'border-top-color'
<li>'border-right-color'
<li>'border-bottom-color'
<li>'border-left-color'
<li>'color'
</ul>

<p>Any property not listed above must not support <span>&lt;quirky-color></span> even if it references one of the above properties in its "Value" grammar.

<p>The <span>&lt;quirky-color></span> value must not be supported in arguments to CSS expressions.

<!--
<p>When a property is said to <dfn>support hashless hex colors</dfn>, all tokens in the property's value <var>tokens</var> must be replaced with the return value of following algorithm prior to interpretation:

<ol>
 <li><p>Let <var>output</var> be an empty array.
 <li><p>Let <var>func</var> be zero.
 <li><p>For each token <var>token</var> in <var>tokens</var>:
  <ol>
   <li><p>If <var>token</var> is a <span>) token</span> and <var>func</var> is greater than zero, decrement <var>func</var> by one and jump to the step labeled <var>append</var>.
   <li><p>If <var>token</var> is a <span>function token</span> or <span>( token</span>, increment <var>func</var> by one and jump to the step labeled <var>append</var>.
   <li><p>Let <var>value</var> be the representation of <var>token</var> if <var>token</var> is a <span>number token</span>, the representation of <var>token</var> followed by the unit of <var>token</var> if <var>token</var> is a <span>dimension token</span>, or the value of <var>token</var> otherwise.
   <li><p>If the following conditions are true, let <var>token</var> be a new <span>hash token</span> token with its value set to <var>value</var>.
    <ul>
     <li><p><var>func</var> is zero.
     <li><p><var>token</var> is a <span>number token</span>, <span>dimension token</span> or <span>identifier token</span>.
     <li><p><var>value</var> has a length that is 3 or 6.
     <li><p><var>value</var> consists of only characters in the range [0-9A-Fa-f] (U+0030 to U+0039, U+0041 to U+0046, U+0061 to U+0066).
    </ul>
   <li><p><i>Append:</i> Append <var>token</var> to <var>output</var>.
  </ol>
 <li><p>Return <var>output</var>.
</ol>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, the following properties <span>support hashless hex colors</span>:

<ul class=brief>
<li>'background-color'
<li>'border-color'
<li>'border-top-color'
<li>'border-right-color'
<li>'border-bottom-color'
<li>'border-left-color'
<li>'color'
</ul>
-->
<!-- research 2012-02-17 using dotnetdotcom's web200904:

$ grep -iaPo "([a-z]+-)?color\s*:\s*[0-9a-f]{3}([0-9a-f]{3})?(\s|\"|\'|;|$)" web200904 > color.txt

>>> f = open('color.txt', 'r')
>>> props = {}
>>> for line in f:
>>> 	prop = line.split(':')[0].rstrip().lower()
>>> 	if prop in props:
>>> 		props[prop] += 1
>>> 	else:
>>> 		props[prop] = 1
>>>
>>> f.close()
>>>
>>> for prop in props:
>>> 	print prop + ':' + str(props[prop])
:28
border-color:2515
color:40731
backgound-color:1
backgroun-color:13
dshadow-color:1
nbackground-color:6
000000;:1
shadow-color:242
face-color:230
text-color:2
dlight-color:216
bottom-color:543
tbackground-color:1
highlight-color:239
arrow-color:228
right-color:326
top-color:304
track-color:272
left-color:330
background-color:8658
font-color:73
darkshadow-color:217
base-color:85
light-color:15

Obviously I made a mistake in the regexp and so e.g. border-right-color shows up as right-color.
Other than typos and scrollbar-* properties, the ones that are used are the ones that are specced.
In particular, outline-color did not show up at all.

-->

<h3>The unitless length quirk</h3>

<p class="status not-tr">Run <a href="http://w3c-test.org/quirks-mode/unitless-length.html">tests</a>

<p>Quirky lengths are denoted by <dfn>&lt;quirky-length></dfn>. A <dfn>quirky length</dfn> is a <span>number</span> and corresponds to a <span>&lt;number-token></span> component value in the syntax. The value of a <span>quirky length</span> is obtained from the component value's value.

<p>The value of a <span>quirky length</span> must be interpreted as a <span>&lt;length></span> where the unit is '<code title>px</code>'.

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, the following properties must have their "Value" grammar changed by replacing <span>&lt;length></span> with [ <span>&lt;length></span> | <span>&lt;quirky-length></span> ]:

<ul class=brief>
<li>'background-position'
<li>'border-spacing'
<li>'border-top-width'
<li>'border-right-width'
<li>'border-bottom-width'
<li>'border-left-width'
<li>'border-width'
<li>'bottom'
<li>'clip'
<li>'font-size'
<li>'height'
<li>'left'
<li>'letter-spacing'
<li>'margin-right'
<li>'margin-left'
<li>'margin-top'
<li>'margin-bottom'
<li>'margin'
<li>'max-height'
<li>'max-width'
<li>'min-height'
<li>'min-width'
<li>'padding-top'
<li>'padding-right'
<li>'padding-bottom'
<li>'padding-left'
<li>'padding'
<li>'right'
<li>'text-indent'
<li>'top'
<li>'vertical-align'
<li>'width'
<li>'word-spacing'
</ul>

<p>Any property not listed above must not support <span>&lt;quirky-length></span> even if it references one of the above properties in its "Value" grammar.

<p>The <span>&lt;quirky-length></span> value must not be supported in arguments to CSS expressions other than the <code title>rect()</code> expression.

<!--
<p>When a property is said to <dfn>support unitless lengths</dfn>, all tokens in the property's value <var>tokens</var> must be replaced with the return value of following algorithm prior to interpretation:

<ol>
 <li><p>Let <var>output</var> be an empty array.
 <li><p>Let <var>func</var> be zero.
 <li><p>For each token <var>token</var> in <var>tokens</var>:
  <ol>
   <li><p>If <var>token</var> is a <span>) token</span> and <var>func</var> is greater than zero, decrement <var>func</var> by one and jump to the step labeled <var>append</var>.
   <li><p>If <var>token</var> is a <span>function token</span> or <span>( token</span>, and <var>token</var>'s value does not <span data-anolis-spec=html title="ASCII case-insensitive">ASCII-case-insensitively</span> consist of the characters "<code title>rect</code>" (U+0072 U+0065 U+0063 U+0074), increment <var>func</var> by one and jump to the step labeled <var>append</var>.
   <li><p>If <var>func</var> is zero and <var>token</var> is a <span>number token</span>, let <var>token</var> be a new <span>dimension token</span> token with the representation set to <var>token</var>'s representation, the value set to <var>token</var>'s value, and the unit set to "<code title>px</code>" (U+0070 U+0078).
   <li><p><i>Append:</i> Append <var>token</var> to <var>output</var>.
  </ol>
 <li><p>Return <var>output</var>.
</ol>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, the following properties <span>support unitless lengths</span>:

<ul class=brief>
<!- -<li>'background-position'- ->
<!- -<li>'border-spacing'- ->
<li>'border-top-width'
<li>'border-right-width'
<li>'border-bottom-width'
<li>'border-left-width'
<li>'border-width'
<li>'bottom'
<li>'clip'
<li>'font-size'
<!- -<li class=XXX>'font'- ->
<li>'height'
<li>'left'
<li>'letter-spacing'
<li>'margin-right'
<li>'margin-left'
<li>'margin-top'
<li>'margin-bottom'
<li>'margin'
<!- -<li>'max-height'- ->
<!- -<li>'max-width'- ->
<!- -<li>'min-height'- ->
<!- -<li>'min-width'- ->
<li>'padding-top'
<li>'padding-right'
<li>'padding-bottom'
<li>'padding-left'
<li>'padding'
<li>'right'
<!- -<li>'text-indent'- ->
<li>'top'
<!- -<li>'vertical-align'- ->
<li>'width'
<li>'word-spacing'
</ul>
-->
<!-- research 2012-02-17 using dotnetdotcom's web200904:

$ grep -iaPo "([a-z]+-)*(position|spacing|width|bottom|clip|size|height|left|right|top|bottom|margin|padding|indent|align|width|end|start|columns|border|shadow)\s*:\s*([1-9][0-9]*(\.[0-9]+)?|[0-9]?\.[0-9]+)(\s|\"|\'|;|$|\/|>)" web200904 > lengths.txt
^C

>>> (see script in hex color quirk section)
:315
x-start:2
3.00":1
pagging-left:8
min-height:38
border-top:842
v-text-spacing:1
                2:1
scrollbar-size:2
line-width:1
               24;:1
border-right:1100
columns:5
border-bottom:1725
border-spacing:7
																		21:1
shadow:3
text-align:8
                            1/:1
e-height:1
8.75":1
                                    750:1
xxpadding-top:2
marging-bottom:2
line-spacing:7
x-archive-position:1
line-height:7209
5":1
font-size:35296
right:1226
cell-spacing:2
              100:1
                              908:1
word-spacing:381
mso-columns:2
padding-top:8168
border-left-size:1
scrollbar-border:2
bottom:101
fp-font-size:362
mmargin-left:1
padding-right:9159
7:1
text-size:2
spacing:243
xxpadding-left:2
tab-width:8
max-width:285
30":1
paddin-top:1
content-size:1
border-right-width:1891
y-position:1
w:1
padding-left:16898
1.50":1
6':1
border-bottom-width:3505
height:31132
max-height:95
margin-right:8283
border-top-width:2438
size:5022
left-margin:1
start:49
bottom-margin:1
top:10483
border-width:5602
min-width:219
width:46530
background-position:135
border-left:887
padding:18278
        2:1
border-height:31
                              5:1
margin:5331
border-left-width:2384
letter-spacing:874
vertical-align:47
clip:5
0.0:1
margin-left:11565
padding-bottom:5279
week-end:1
border:4664
end:68
installed-size:1
margin-bottom:11898
lin-height:12
																		102:1
4":1
nfont-size:10
z-position:1
text-indent:378
midlet-jar-size:1
one-day-left:1
margin-top:11393
position:80
left:9219


Forgot to include "-" before the number in the regex (e.g. text-indent accepts negative values).

$ grep -iaPo "([a-z]+-)*(position|spacing|width|bottom|clip|size|height|left|right|top|bottom|margin|padding|indent|align|width|end|start|columns|border|shadow)\s*:\s*-([1-9][0-9]*(\.[0-9]+)?|[0-9]?\.[0-9]+)(\s|\"|\'|;|$|\/|>)" web200904 > negative-lengths.txt
^C

>>> (see script in hex color quirk section)
:1
letter-spacing:31
right:3
bottom:2
top:56
margin-right:4
padding-left:1
margin-bottom:33
word-spacing:1
margin-top:68
margin-left:61
padding-top:1
size:2
margin:6
left:16


'clip'

$ grep -iaPo "clip\s*:\s*rect\([^\)]+\)" web200904 > clip.txt
^C

Looks like 'clip' is used with and without commas, with and without units.


'font'

$ grep -iaPo "font\s*:\s*[^;\}>]+" web200904 > font.txt
^C

I appended a ";" after each line, removed all " and ' (which shouldn't affect the font-size thing)
and put the whole thing in a ruleset and loaded it in a quirks mode doc vs a no-quirks mode doc in
Firefox to see what was logged to the error console. There were 120465 lines, supposedly 'font'
declarations. 157+4+6+1+1+1 errors in the console in both quirks mode and no-quirks mode. This means
none of them had unitless font-size. Most common error seemed to be to omit the font-size and/or
font-family. This may need more research, but maybe we don't need this quirk for 'font'.

-->

<!-- XXX
http://lists.whatwg.org/pipermail/whatwg-whatwg.org/2012-February/034847.html

davidb:

To be exact, they don't apply inside the following shorthands:
  -moz-border-end
  -moz-border-start
  -moz-columns
  background
  border
  border-bottom
  border-image
  border-left
  border-right
  border-top
  the size/weight/style and family parts of 'font'
  list-style
  outline
and also don't apply inside the following complex properties:
  box-shadow
  text-shadow


simonp:

font:60 serif

and has a 60px font size in Firefox Nightly for me.

These also get applied:

font:101 serif
font:100 60 serif
font:100 100 serif
font:bold 100 serif
font:normal normal normal 100 serif

These don't:

font:100 serif
font:100/1 serif
font:normal 100 serif
font:normal normal 100 serif

-->

<!-- the space before unit quirk:

$ grep -iaPo "([a-z]+-)*(position|spacing|width|bottom|clip|size|height|left|right|top|bottom|margin|padding|indent|align|width|end|start|columns|border|shadow)\s*:\s*-?([1-9][0-9]*(\.[0-9]+)?|[0-9]?\.[0-9]+)\s+(px|em|ex|cm|mm|in|pt|pc)" web200904 > space-before-unit.txt
6265 matches

Opera supported this quirk (copied from IE), but then dropped it because it broke sites that expected IE's different margin collapsing or Firefox's non-support for the quirk, or some such, and was thus dropped. CORE-9273

-->

<h3>The line height calculation quirk</h3>

<p class="status not-tr">Run <a href="http://w3c-test.org/quirks-mode/line-height-calculation.html">tests</a>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span> and <span data-anolis-spec=dom title=concept-document-limited-quirks>limited-quirks mode</span>, an inline box that matches the following conditions, must, for the purpose of line height calculation, act as if the box had a 'line-height' of zero.

<ul>
 <li><p>The 'border-right-width', 'border-left-width', 'padding-right' and 'padding-left' properties have a used value of zero. <!-- This matches WebKit. Opera and IE9 don't have this [Opera has now implemented this (CORE-19183)]. Gecko has this rule for all margins, paddings and borders. -->
 <li><p>It either contains no text or it contains only collapsed whitespace. <!-- This matches Gecko and WebKit. IE still uses the quirk in "<pre><img> ". Opera still uses the quirk in "<p><img> <img>". --> <!-- For the purpose of this bullet point, the 'white-space' processing model must not remove a space (U+0020) at the end of a line has 'white-space' set to 'normal', 'nowrap', or 'pre-line' as each line is laid out. (This matches Firefox but not WebKit. Opera had a bug about a site that relied on the Firefox behavior.)-->
</ul>

<h3>The blocks ignore line-height quirk</h3>

<p class="status not-tr">Run <a href="http://w3c-test.org/quirks-mode/blocks-ignore-line-height.html">tests</a>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span> and <span data-anolis-spec=dom title=concept-document-limited-quirks>limited-quirks mode</span>, for a <span>block container element</span> whose content is composed of <span>inline-level</span> elements, the element's 'line-height' must be ignored for the purpose of calculating the minimal height of line boxes within the element.

<p class=note>This means that the "strut" is not created.

<h3>The percentage height calculation quirk</h3>

<p class="status not-tr">Run <a href="http://w3c-test.org/quirks-mode/percentage-height-calculation.html">tests</a>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, for the purpose of calculating the 'height' of an element <var>element</var>, if the computed value of the 'position' property of <var>element</var> is 'relative' or 'static', the specified value for the 'height' property of <var>element</var> is a &lt;percentage>, and <var>element</var> does not have a computed value of the 'display' property that is 'table-row', 'table-row-group', 'table-header-group', 'table-footer-group', 'table-cell' or 'table-caption', the <span>containing block</span> of <var>element</var> must be calculated using the following algorithm, aborting on the first step that returns a value:

<ol>
  <li><p>Let <var>element</var> be the nearest ancestor <span>block container box</span> of <var>element</var>, if there is one. Otherwise, return the <span>initial containing block</span>.
  <li><p>If <var>element</var> has a computed value of the 'display' property that is 'table-cell', return a UA-defined value.
  <li><p>If <var>element</var> has a computed value of the 'height' property that is not 'auto', return <var>element</var>.
  <li><p>If <var>element</var> has a computed value of the 'position' property that is 'absolute', return <var>element</var>.
  <li><p>If <var>element</var> is a <code>body</code> element, and its parent is the root element, and that is an <code>html</code> element, let <var>element</var> have a <span>quirky containing block height</span> and return <var>element</var>.
  <li><p>Jump to the first step.
</ol>

<p>When an element <var>body</var> is said to have a <dfn>quirky containing block height</dfn>, the <span>containing block</span> the element establishes must act as if it had a height calculated using the following algorithm:

<ol>
  <li><p>If the root element has a computed value of the 'height' property that is 'auto' and has a computed value of the 'position' property that is 'absolute', return 'auto' and abort these steps.
  <li><p>Let <var>elements</var> be an array with <var>body</var> as its only item.
  <li><p>If the root element has a computed value of the 'height' property that is not 'auto', let <var>A</var> be the used value of the 'height' property of the root element. Otherwise, let <var>A</var> be the height of the <span>initial containing block</span> and append the root element to <var>elements</var>.
  <li><p>Let <var>B</var> be the sum of the used values of the 'margin-top', 'margin-bottom', 'border-top-width', 'border-bottom-width', 'padding-top' and 'padding-bottom' properties of each element in <var>elements</var>.
  <li><p>Let <var>result</var> be <var>A</var> minus <var>B</var>.
  <li><p>If <var>result</var> is negative, let <var>result</var> be zero.
  <li><p>Return <var>result</var>.
</ol>

<p class=note>It is at the time or writing undefined how percentage heights inside tables work in CSS. This specification does not try to specify what to use as the containing block for calculating percentage heights in tables. Godspeed!

<h3>The table cell width calculation quirk</h3>

<p class="status not-tr">Run <a href="http://w3c-test.org/quirks-mode/table-cell-width-calculation.html">tests</a>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, for the purpose of calculating the <span>minimum intrinsic width of an inline formatting context</span> for which a table cell <var>cell</var> is the <span>containing block</span>, if <var>cell</var> has a computed value of the 'width' property that is 'auto', <code>img</code> elements that are inline replaced elements or inline-block replaced elements in that inline formatting context must not have a line breaking opportunity before or after them.

<!-- http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsImageFrame.cpp#2053 -->

<h3>The table cell nowrap minimum width calculation quirk</h3>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, an element <var>cell</var> that matches the following conditions must act as if it had an <span>outer intrinsic minimum width of a table cell</span> in the automatic table layout algorithm that is the bigger value of <var>cell</var>'s computed value of the 'width' property and the <span>outer intrinsic minimum width of a table cell</span>.

<ul>
  <li><p><var>cell</var> is a <code>td</code> element or a <code>th</code> element.
  <li><p><var>cell</var> has a <code>nowrap</code> attribute.
  <li><p>The computed value of the 'width' property of <var>cell</var> is a &lt;length> that is not zero.
</ul>

<h3>The collapsing table quirk</h3>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, an element <var>table</var> that matches the following conditions must have a used value of the 'height' property of '0' and a used value of the 'border-style' property of 'none'.

<ul>
  <li><p><var>table</var> has a computed value of the 'display' property that is 'table'.
  <li><p><var>table</var> has no child 'table-row-group', 'table-header-group', 'table-footer-group' or 'table-caption' box.
  <li><p><var>table</var> has no child 'table-column-group' box that itself has a child 'table-column' box.
</ul>

<h3>The text decoration doesn't propagate into tables quirk</h3>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, text decoration must not propagate into <code>table</code> elements.

<!-- http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsTextFrameThebes.cpp#4582 -->

<h3>The font element text decoration color quirk</h3>

<p class="status not-tr">Run <a href="http://w3c-test.org/quirks-mode/font-element-text-decoration-color/">tests</a>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span> and <span data-anolis-spec=dom title=concept-document-limited-quirks>limited-quirks mode</span>, the <code>font</code> element must override the color of any text decoration that spans the text of the element to the used value of the element's 'color' property.

<h3>The tables inherit color from body quirk</h3>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, the initial value of the 'color' property must be 'quirk-inherit', a special value that has no keyword mapping to it.

<p>The computed value of the 'color' property of an element <var>element</var> must be calculated using the following algorithm:

<ol>
  <li><p>If the specified value of the 'color' property of <var>element</var> is not 'quirk-inherit', jump to the last step.
  <li><p>If <var>element</var> is not a <code>table</code> element, jump to the last step.
  <li><p>If the <span>document's body element</span> is null, jump to the last step.
  <li><p>Return the used value of the 'color' property of the <span>document's body element</span>. Abort these steps.
  <li><p>If the specified value of the 'color' property of <var>element</var> is 'quirk-inherit', let the specified value of the 'color' property of <var>element</var> be the initial value of the 'color' property according to the CSS specification. Return the computed value of the 'color' property of <var>element</var> as specified in the CSS specification.
</ol>

<p>The <dfn>document's body element</dfn> is the first child of the root element that is a <code>body</code> element, if there is one, and the root element is an <code>html</code> element. Otherwise it is null.

<!--
<h3>The font size calculation quirk</h3>

<p class="status not-tr">Status: Needs research.

<pre class=XXX>http://mxr.mozilla.org/mozilla-central/source/layout/style/nsStyleUtil.cpp#64
http://trac.webkit.org/browser/trunk/Source/WebCore/css/CSSStyleSelector.cpp?rev=113922#L4920</pre>

Opera and IE (any mode) don't have this quirk.

https://bugzilla.mozilla.org/show_bug.cgi?id=747464
https://bugs.webkit.org/show_bug.cgi?id=84469
-->

<h3>The table cell height box sizing quirk</h3>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, elements that have a computed value of the 'display' property of 'table-cell' must act as they have used value of the 'box-sizing' property of 'border-box', but only for the purpose of the 'height', 'min-height' and 'max-height' properties.

<h2>Selectors</h2>

<h3>The :active and :hover quirk</h3>

<p class="status not-tr">Run <a href="http://w3c-test.org/quirks-mode/active-and-hover-manual.html">tests</a>

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, a compound selector <var>selector</var> that matches the following conditions must not match elements that would not also match the ':any-link' selector. <span data-anolis-ref>SELECTORS</span>

<ul>
 <li><var>selector</var> uses the ':active' or ':hover' pseudo-classes.
 <li><var>selector</var> does not use a type selector.
 <li><var>selector</var> does not use an attribute selector.
 <li><var>selector</var> does not use an ID selector.
 <li><var>selector</var> does not use a class selector.
 <li><var>selector</var> does not use a pseudo-class selector other than ':active' and ':hover'.
 <li><var>selector</var> does not use a pseudo-element selector.
 <li><var>selector</var> is not part of an argument to a functional pseudo-class or pseudo-element.
</ul>

<!--<h2>HTML</h2>-->
<!--
<h3>The braces in style attribute quirk</h3>

<p class="status not-tr">Status: Needs research.

<p>In <span data-anolis-spec=dom title=concept-document-quirks>quirks mode</span>, when parsing the <code>style</code> attribute on <span>HTML elements</span>, if the first token is "<code title>{</code>" (U+007B), that token must be ignored. If it was present, and a later matching token "<code title>}</code>" (U+0079) is found, that token, and all tokens after it, must also be ignored.</p>

<p class="XXX">Can we drop this quirk? WebKit and IE9 in non-compat view don't support it. Its usage in the wild is on the same order as the "space before unit" quirk<!- - see unitless length section - ->, which Firefox doesn't support, and which Opera has dropped support for.
-->

<!--
grep -iaPo "<[a-z]+\s[^>]*style\s*=\s*[\"']{[^\"'>]+" web200904 > style-braces.txt
6556 matches
-->

<!--
<h2>Quirks that maybe can be removed from implementations</h2>

<dl>
<dt>In quirks mode, text-decoration is propagated into floating and absolutely positioned elements</dt>
<dd><p>Opera, WebKit and IE9 (except in compat view quirks mode) don't support this quirk.</dd>

<dt>The empty-cells property defaults to hide in quirks mode but show (according to CSS2 errata) in strict mode (see  bug 33244 ) (though the correct fix would be to specify it on the HTML TABLE element in quirk.css).</dt>
<dd><p>WebKit and IE9 (except in compat view quirks and no-quirks modes) do not support this quirk.</dd>

<dt>In quirks mode, the CSS parser allows {} around the contents of style attributes ( bug 99554 )</dt>
<dd><p>WebKit and IE9 (except in compat view quirks mode) don't support this quirk. Its usage in the wild is on the same order as the "space before unit" quirk<!- - see unitless length section - ->, which Firefox doesn't support, and which Opera has dropped support for.</dd>

</dl>
-->
<!--
http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsBlockReflowState.cpp#696
Opera/WebKit don't have this quirk.
http://software.hixie.ch/utilities/js/live-dom-viewer/saved/1405
-->
<!--
http://mxr.mozilla.org/mozilla-central/source/layout/tables/nsTableFrame.cpp#1309
Opera/WebKit don't have this quirk.
http://software.hixie.ch/utilities/js/live-dom-viewer/saved/1406
-->
<!-- XXX not clear to me what these do:
http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsBRFrame.cpp#137
http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsHTMLReflowState.cpp#414
http://mxr.mozilla.org/mozilla-central/source/layout/style/nsRuleProcessorData.h#234
http://mxr.mozilla.org/mozilla-central/source/layout/style/nsStyleUtil.cpp#172
http://mxr.mozilla.org/mozilla-central/source/layout/base/nsCSSRendering.cpp#573
http://mxr.mozilla.org/mozilla-central/source/content/base/src/nsGenericElement.cpp#2110
-->
<!--
<h2>Quirks that have moved to other specifications</h2>

<p><dfn>The hashless hex color quirk</dfn> and <dfn>the unitless length quirk</dfn> are now defined in CSS Syntax Module Level 3. <span data-anolis-ref>CSSSYNTAX</span>
-->
<h2 class=no-num>References</h2>

<div id=anolis-references></div>


<h2 class=no-num>Acknowledgments</h2>

<p>Thanks to

Anne van Kesteren,
Boris Zbarsky,
David Baron,
Kang-Hao Lu,
Ms2ger,
Simon Sapin
and
Tab Atkins

for their useful comments.

<p>Special thanks to Boris Zbarsky and David Baron for documenting Mozilla's quirks in MDN.
